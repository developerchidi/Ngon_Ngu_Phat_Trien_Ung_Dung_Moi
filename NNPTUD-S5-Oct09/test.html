<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API - Product & Category Management</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .section {
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .response {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .response.success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .response.error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .status-success {
            background-color: #28a745;
            color: white;
        }
        .status-error {
            background-color: #dc3545;
            color: white;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
        .auth-section {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>
<body>
    <h1>üß™ Test API - Product & Category Management</h1>
    
    <div class="container auth-section">
        <h2>üîê Authentication</h2>
        <div class="form-group">
            <label>Username:</label>
            <input type="text" id="loginUsername" placeholder="username">
        </div>
        <div class="form-group">
            <label>Password:</label>
            <input type="password" id="loginPassword" placeholder="password">
        </div>
        <button onclick="login()" class="btn-success">Login</button>
        <button onclick="logout()">Logout</button>
        <div id="authResponse" class="response" style="display: none;"></div>
    </div>

    <div class="grid">
        <!-- Category Management -->
        <div class="container">
            <h2>üìÇ Category Management</h2>
            
            <div class="section">
                <h3>Create Category (MOD, ADMIN)</h3>
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="categoryName" placeholder="category name">
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <textarea id="categoryDescription" placeholder="category description"></textarea>
                </div>
                <button onclick="createCategory()" class="btn-success">Create Category</button>
            </div>

            <div class="section">
                <h3>Get All Categories (USER, MOD, ADMIN)</h3>
                <button onclick="getAllCategories()">Get All Categories</button>
            </div>

            <div class="section">
                <h3>Get Category by ID (USER, MOD, ADMIN)</h3>
                <div class="form-group">
                    <label>Category ID:</label>
                    <input type="text" id="categoryId" placeholder="category id">
                </div>
                <button onclick="getCategoryById()">Get Category</button>
            </div>

            <div class="section">
                <h3>Update Category (MOD, ADMIN)</h3>
                <div class="form-group">
                    <label>Category ID:</label>
                    <input type="text" id="updateCategoryId" placeholder="category id">
                </div>
                <div class="form-group">
                    <label>New Name:</label>
                    <input type="text" id="updateCategoryName" placeholder="new name">
                </div>
                <div class="form-group">
                    <label>New Description:</label>
                    <textarea id="updateCategoryDescription" placeholder="new description"></textarea>
                </div>
                <button onclick="updateCategory()" class="btn-success">Update Category</button>
            </div>

            <div class="section">
                <h3>Delete Category (ADMIN only)</h3>
                <div class="form-group">
                    <label>Category ID:</label>
                    <input type="text" id="deleteCategoryId" placeholder="category id">
                </div>
                <button onclick="deleteCategory()" class="btn-danger">Delete Category</button>
            </div>

            <div id="categoryResponse" class="response" style="display: none;"></div>
        </div>

        <!-- Product Management -->
        <div class="container">
            <h2>üì¶ Product Management</h2>
            
            <div class="section">
                <h3>Create Product (MOD, ADMIN)</h3>
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="productName" placeholder="product name">
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <textarea id="productDescription" placeholder="product description"></textarea>
                </div>
                <div class="form-group">
                    <label>Price:</label>
                    <input type="number" id="productPrice" placeholder="0" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Stock:</label>
                    <input type="number" id="productStock" placeholder="0" min="0">
                </div>
                <div class="form-group">
                    <label>Image URL:</label>
                    <input type="url" id="productImageUrl" placeholder="https://example.com/image.jpg">
                </div>
                <div class="form-group">
                    <label>Category ID:</label>
                    <input type="text" id="productCategoryId" placeholder="category id">
                </div>
                <button onclick="createProduct()" class="btn-success">Create Product</button>
            </div>

            <div class="section">
                <h3>Get All Products (USER, MOD, ADMIN)</h3>
                <div class="form-group">
                    <label>Search:</label>
                    <input type="text" id="productSearch" placeholder="search products">
                </div>
                <div class="form-group">
                    <label>Category ID:</label>
                    <input type="text" id="productCategoryFilter" placeholder="filter by category">
                </div>
                <button onclick="getAllProducts()">Get All Products</button>
            </div>

            <div class="section">
                <h3>Get Product by ID (USER, MOD, ADMIN)</h3>
                <div class="form-group">
                    <label>Product ID:</label>
                    <input type="text" id="productId" placeholder="product id">
                </div>
                <button onclick="getProductById()">Get Product</button>
            </div>

            <div class="section">
                <h3>Update Product (MOD, ADMIN)</h3>
                <div class="form-group">
                    <label>Product ID:</label>
                    <input type="text" id="updateProductId" placeholder="product id">
                </div>
                <div class="form-group">
                    <label>New Name:</label>
                    <input type="text" id="updateProductName" placeholder="new name">
                </div>
                <div class="form-group">
                    <label>New Description:</label>
                    <textarea id="updateProductDescription" placeholder="new description"></textarea>
                </div>
                <div class="form-group">
                    <label>New Price:</label>
                    <input type="number" id="updateProductPrice" placeholder="new price" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>New Stock:</label>
                    <input type="number" id="updateProductStock" placeholder="new stock" min="0">
                </div>
                <div class="form-group">
                    <label>New Image URL:</label>
                    <input type="url" id="updateProductImageUrl" placeholder="new image url">
                </div>
                <div class="form-group">
                    <label>New Category ID:</label>
                    <input type="text" id="updateProductCategoryId" placeholder="new category id">
                </div>
                <button onclick="updateProduct()" class="btn-success">Update Product</button>
            </div>

            <div class="section">
                <h3>Delete Product (ADMIN only)</h3>
                <div class="form-group">
                    <label>Product ID:</label>
                    <input type="text" id="deleteProductId" placeholder="product id">
                </div>
                <button onclick="deleteProduct()" class="btn-danger">Delete Product</button>
            </div>

            <div id="productResponse" class="response" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';
        let authToken = '';

        // Utility function to show response
        function showResponse(elementId, data, isSuccess = null) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            
            // Remove existing status classes
            element.classList.remove('success', 'error');
            
            // Determine success status
            if (isSuccess === null) {
                isSuccess = data.success === true || (data.success === undefined && !data.error);
            }
            
            // Add appropriate class
            if (isSuccess) {
                element.classList.add('success');
            } else {
                element.classList.add('error');
            }
            
            // Format response with status indicator
            const statusText = isSuccess ? '‚úÖ TH√ÄNH C√îNG' : '‚ùå L·ªñI';
            const statusClass = isSuccess ? 'status-success' : 'status-error';
            
            element.innerHTML = `
                <div class="status-indicator ${statusClass}">${statusText}</div>
                <div>${JSON.stringify(data, null, 2)}</div>
            `;
        }

        // Authentication functions
        async function login() {
            try {
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;
                
                if (!username || !password) {
                    showResponse('authResponse', { error: 'Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß username v√† password' }, false);
                    return;
                }
                
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                if (data.success) {
                    authToken = data.data;
                    showResponse('authResponse', { message: 'ƒêƒÉng nh·∫≠p th√†nh c√¥ng', token: authToken }, true);
                } else {
                    showResponse('authResponse', data, false);
                }
            } catch (error) {
                showResponse('authResponse', { error: error.message }, false);
            }
        }

        async function logout() {
            try {
                const response = await fetch(`${API_BASE}/auth/logout`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                authToken = '';
                showResponse('authResponse', data, data.success);
            } catch (error) {
                showResponse('authResponse', { error: error.message }, false);
            }
        }

        // Helper function to get headers with auth
        function getAuthHeaders() {
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            };
        }

        // Category functions
        async function createCategory() {
            try {
                const name = document.getElementById('categoryName').value;
                const description = document.getElementById('categoryDescription').value;
                
                if (!name.trim()) {
                    showResponse('categoryResponse', { error: 'T√™n category l√† b·∫Øt bu·ªôc' }, false);
                    return;
                }
                
                const response = await fetch(`${API_BASE}/categories`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({ name, description })
                });
                
                const data = await response.json();
                showResponse('categoryResponse', data, data.success);
                
                if (data.success) {
                    document.getElementById('categoryName').value = '';
                    document.getElementById('categoryDescription').value = '';
                }
            } catch (error) {
                showResponse('categoryResponse', { error: error.message }, false);
            }
        }

        async function getAllCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResponse('categoryResponse', data, data.success);
            } catch (error) {
                showResponse('categoryResponse', { error: error.message }, false);
            }
        }

        async function getCategoryById() {
            try {
                const id = document.getElementById('categoryId').value;
                if (!id) {
                    showResponse('categoryResponse', { error: 'Vui l√≤ng nh·∫≠p Category ID' }, false);
                    return;
                }
                
                const response = await fetch(`${API_BASE}/categories/${id}`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResponse('categoryResponse', data, data.success);
            } catch (error) {
                showResponse('categoryResponse', { error: error.message }, false);
            }
        }

        async function updateCategory() {
            try {
                const id = document.getElementById('updateCategoryId').value;
                const name = document.getElementById('updateCategoryName').value;
                const description = document.getElementById('updateCategoryDescription').value;
                
                if (!id) {
                    showResponse('categoryResponse', { error: 'Vui l√≤ng nh·∫≠p Category ID' }, false);
                    return;
                }
                
                const body = {};
                if (name) body.name = name;
                if (description) body.description = description;
                
                const response = await fetch(`${API_BASE}/categories/${id}`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(body)
                });
                
                const data = await response.json();
                showResponse('categoryResponse', data, data.success);
            } catch (error) {
                showResponse('categoryResponse', { error: error.message }, false);
            }
        }

        async function deleteCategory() {
            try {
                const id = document.getElementById('deleteCategoryId').value;
                
                if (!id) {
                    showResponse('categoryResponse', { error: 'Vui l√≤ng nh·∫≠p Category ID' }, false);
                    return;
                }
                
                const response = await fetch(`${API_BASE}/categories/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResponse('categoryResponse', data, data.success);
            } catch (error) {
                showResponse('categoryResponse', { error: error.message }, false);
            }
        }

        // Product functions
        async function createProduct() {
            try {
                const name = document.getElementById('productName').value;
                const description = document.getElementById('productDescription').value;
                const price = document.getElementById('productPrice').value;
                const stock = document.getElementById('productStock').value;
                const imageUrl = document.getElementById('productImageUrl').value;
                const category = document.getElementById('productCategoryId').value;
                
                if (!name || !price || !category) {
                    showResponse('productResponse', { error: 'Name, price, v√† category l√† b·∫Øt bu·ªôc' }, false);
                    return;
                }
                
                const body = { name, description, price, stock, imageUrl, category };
                
                const response = await fetch(`${API_BASE}/products`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(body)
                });
                
                const data = await response.json();
                showResponse('productResponse', data, data.success);
                
                if (data.success) {
                    // Clear form
                    document.getElementById('productName').value = '';
                    document.getElementById('productDescription').value = '';
                    document.getElementById('productPrice').value = '';
                    document.getElementById('productStock').value = '';
                    document.getElementById('productImageUrl').value = '';
                    document.getElementById('productCategoryId').value = '';
                }
            } catch (error) {
                showResponse('productResponse', { error: error.message }, false);
            }
        }

        async function getAllProducts() {
            try {
                const search = document.getElementById('productSearch').value;
                const category = document.getElementById('productCategoryFilter').value;
                
                let url = `${API_BASE}/products`;
                const params = new URLSearchParams();
                if (search) params.append('search', search);
                if (category) params.append('category', category);
                
                if (params.toString()) {
                    url += '?' + params.toString();
                }
                
                const response = await fetch(url, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResponse('productResponse', data, data.success);
            } catch (error) {
                showResponse('productResponse', { error: error.message }, false);
            }
        }

        async function getProductById() {
            try {
                const id = document.getElementById('productId').value;
                if (!id) {
                    showResponse('productResponse', { error: 'Vui l√≤ng nh·∫≠p Product ID' }, false);
                    return;
                }
                
                const response = await fetch(`${API_BASE}/products/${id}`, {
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResponse('productResponse', data, data.success);
            } catch (error) {
                showResponse('productResponse', { error: error.message }, false);
            }
        }

        async function updateProduct() {
            try {
                const id = document.getElementById('updateProductId').value;
                const name = document.getElementById('updateProductName').value;
                const description = document.getElementById('updateProductDescription').value;
                const price = document.getElementById('updateProductPrice').value;
                const stock = document.getElementById('updateProductStock').value;
                const imageUrl = document.getElementById('updateProductImageUrl').value;
                const category = document.getElementById('updateProductCategoryId').value;
                
                if (!id) {
                    showResponse('productResponse', { error: 'Vui l√≤ng nh·∫≠p Product ID' }, false);
                    return;
                }
                
                const body = {};
                if (name) body.name = name;
                if (description) body.description = description;
                if (price) body.price = price;
                if (stock) body.stock = stock;
                if (imageUrl) body.imageUrl = imageUrl;
                if (category) body.category = category;
                
                const response = await fetch(`${API_BASE}/products/${id}`, {
                    method: 'PUT',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(body)
                });
                
                const data = await response.json();
                showResponse('productResponse', data, data.success);
            } catch (error) {
                showResponse('productResponse', { error: error.message }, false);
            }
        }

        async function deleteProduct() {
            try {
                const id = document.getElementById('deleteProductId').value;
                
                if (!id) {
                    showResponse('productResponse', { error: 'Vui l√≤ng nh·∫≠p Product ID' }, false);
                    return;
                }
                
                const response = await fetch(`${API_BASE}/products/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                });
                const data = await response.json();
                showResponse('productResponse', data, data.success);
            } catch (error) {
                showResponse('productResponse', { error: error.message }, false);
            }
        }
    </script>
</body>
</html>
